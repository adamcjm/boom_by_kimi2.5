<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âš ï¸ æ‹†å¼¹ä¸“å®¶ - ç”Ÿæ­»å€’è®¡æ—¶ âš ï¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
        
        * {
            font-family: 'Share Tech Mono', monospace;
        }
        
        body {
            background: #0a0a0a;
            overflow: hidden;
        }
        
        .scanline {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                to bottom,
                rgba(255,255,255,0),
                rgba(255,255,255,0) 50%,
                rgba(0,0,0,0.2) 50%,
                rgba(0,0,0,0.2)
            );
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 50;
        }
        
        .crt-flicker {
            animation: flicker 0.15s infinite;
        }
        
        @keyframes flicker {
            0% { opacity: 0.97; }
            50% { opacity: 1; }
            100% { opacity: 0.98; }
        }
        
        .glitch {
            animation: glitch 2s infinite;
        }
        
        @keyframes glitch {
            0%, 100% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
        }
        
        .pulse-red {
            animation: pulseRed 1s infinite;
        }
        
        @keyframes pulseRed {
            0%, 100% { 
                box-shadow: 0 0 20px #ff0000, 0 0 40px #ff0000, inset 0 0 20px rgba(255,0,0,0.3);
                border-color: #ff0000;
            }
            50% { 
                box-shadow: 0 0 40px #ff0000, 0 0 80px #ff0000, inset 0 0 40px rgba(255,0,0,0.5);
                border-color: #ff3333;
            }
        }
        
        .pulse-warning {
            animation: pulseWarning 0.5s infinite;
        }
        
        @keyframes pulseWarning {
            0%, 100% { 
                box-shadow: 0 0 30px #ff6600, 0 0 60px #ff6600;
            }
            50% { 
                box-shadow: 0 0 60px #ff6600, 0 0 120px #ff6600;
            }
        }
        
        .timer-glow {
            text-shadow: 0 0 10px currentColor, 0 0 20px currentColor, 0 0 40px currentColor;
        }
        
        .wire {
            transition: all 0.3s ease;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="%23ccc" stroke-width="2"><circle cx="6" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><line x1="20" y1="4" x2="8.12" y2="15.88"/><line x1="14.47" y1="14.48" x2="20" y2="20"/><line x1="8.12" y1="8.12" x2="12" y2="12"/></svg>') 16 16, pointer;
            position: relative;
        }
        
        .wire:hover {
            filter: brightness(1.3);
            transform: scale(1.02);
        }
        
        .wire.cut {
            opacity: 0.3;
            filter: grayscale(100%);
        }
        
        .wire.cut::after {
            content: 'âœ‚ï¸';
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 20px;
            animation: snip 0.3s ease;
        }
        
        @keyframes snip {
            0% { transform: translateY(-50%) rotate(0deg) scale(1); }
            50% { transform: translateY(-50%) rotate(-20deg) scale(1.2); }
            100% { transform: translateY(-50%) rotate(0deg) scale(1); }
        }
        
        .shake {
            animation: shake 0.5s infinite;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .heartbeat {
            animation: heartbeat 1.5s infinite;
        }
        
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            14% { transform: scale(1.05); }
            28% { transform: scale(1); }
            42% { transform: scale(1.05); }
            70% { transform: scale(1); }
        }
        
        .code-input {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #333;
            color: #0f0;
            text-shadow: 0 0 10px #0f0;
        }
        
        .code-input:focus {
            outline: none;
            border-color: #0f0;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
        }
        
        .module {
            background: linear-gradient(145deg, #1a1a1a, #0d0d0d);
            border: 2px solid #333;
            box-shadow: inset 0 2px 4px rgba(255,255,255,0.05), 0 4px 8px rgba(0,0,0,0.5);
        }
        
        .btn-tech {
            background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
            border: 2px solid #444;
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: all 0.3s ease;
        }
        
        .btn-tech:hover {
            background: linear-gradient(145deg, #3a3a3a, #2a2a2a);
            border-color: #666;
            box-shadow: 0 0 20px rgba(255,255,255,0.2);
        }
        
        .btn-tech:active {
            transform: translateY(2px);
        }
        
        .btn-danger {
            background: linear-gradient(145deg, #4a0000, #2a0000);
            border-color: #ff0000;
            color: #ff0000;
        }
        
        .btn-danger:hover {
            background: linear-gradient(145deg, #6a0000, #4a0000);
            box-shadow: 0 0 30px rgba(255,0,0,0.5);
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #ff0000 0%, #ff6600 50%, #ffff00 100%);
            box-shadow: 0 0 10px currentColor;
        }
        
        .led {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #330000;
            border: 1px solid #550000;
            transition: all 0.3s ease;
        }
        
        .led.active {
            background: #ff0000;
            box-shadow: 0 0 10px #ff0000, 0 0 20px #ff0000;
        }
        
        .led.safe {
            background: #00ff00;
            box-shadow: 0 0 10px #00ff00, 0 0 20px #00ff00;
        }
        
        .led.warning {
            background: #ffaa00;
            box-shadow: 0 0 10px #ffaa00, 0 0 20px #ffaa00;
        }
        
        .binary-bg {
            position: absolute;
            font-size: 14px;
            color: rgba(0, 255, 0, 0.1);
            pointer-events: none;
            user-select: none;
        }
        
        .warning-text {
            color: #ff0000;
            text-shadow: 0 0 10px #ff0000;
        }
        
        .safe-text {
            color: #00ff00;
            text-shadow: 0 0 10px #00ff00;
        }
        
        .panel-corner {
            position: absolute;
            width: 20px;
            height: 20px;
            border: 2px solid #ff0000;
        }
        
        .panel-corner.tl { top: -2px; left: -2px; border-right: none; border-bottom: none; }
        .panel-corner.tr { top: -2px; right: -2px; border-left: none; border-bottom: none; }
        .panel-corner.bl { bottom: -2px; left: -2px; border-right: none; border-top: none; }
        .panel-corner.br { bottom: -2px; right: -2px; border-left: none; border-top: none; }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #333;
            transition: .4s;
            border-radius: 30px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: #666;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #ff0000;
        }
        
        input:checked + .slider:before {
            transform: translateX(30px);
            background-color: #fff;
        }
        
        .log-entry {
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .explosion {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, #ffffff 0%, #ffff00 5%, #ff6600 20%, #ff0000 40%, #660000 60%, #000 80%);
            opacity: 0;
            pointer-events: none;
            z-index: 100;
        }
        
        .explosion.active {
            animation: explode 3s ease-out forwards;
        }
        
        @keyframes explode {
            0% { 
                opacity: 0; 
                transform: scale(0);
                filter: brightness(1);
            }
            10% { 
                opacity: 1; 
                transform: scale(0.5);
                filter: brightness(3);
            }
            30% { 
                opacity: 1; 
                transform: scale(1.5);
                filter: brightness(2);
            }
            50% { 
                opacity: 0.9; 
                transform: scale(2);
                filter: brightness(1.5);
            }
            70% { 
                opacity: 0.6; 
                transform: scale(2.5);
                filter: brightness(1);
            }
            100% { 
                opacity: 0; 
                transform: scale(3);
                filter: brightness(0.5);
            }
        }
        
        /* ç«ç„°æ•ˆæœ */
        .fire-particle {
            position: fixed;
            border-radius: 50%;
            pointer-events: none;
            z-index: 99;
            animation: fire-rise 2s ease-out forwards;
        }
        
        @keyframes fire-rise {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            50% {
                opacity: 0.8;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) scale(0.3);
                opacity: 0;
            }
        }
        
        /* å†²å‡»æ³¢æ•ˆæœ */
        .shockwave {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 10px solid rgba(255, 100, 0, 0.8);
            border-radius: 50%;
            pointer-events: none;
            z-index: 98;
            opacity: 0;
        }
        
        .shockwave.active {
            animation: shockwave-expand 2s ease-out forwards;
        }
        
        @keyframes shockwave-expand {
            0% {
                width: 0;
                height: 0;
                opacity: 1;
                border-width: 20px;
            }
            100% {
                width: 200vmax;
                height: 200vmax;
                opacity: 0;
                border-width: 0;
            }
        }
        
        /* å±å¹•éœ‡åŠ¨æ•ˆæœ */
        .screen-shake {
            animation: screenShake 0.5s ease-in-out;
        }
        
        @keyframes screenShake {
            0%, 100% { transform: translate(0, 0); }
            10% { transform: translate(-10px, 10px); }
            20% { transform: translate(10px, -10px); }
            30% { transform: translate(-10px, -10px); }
            40% { transform: translate(10px, 10px); }
            50% { transform: translate(-5px, 5px); }
            60% { transform: translate(5px, -5px); }
            70% { transform: translate(-5px, -5px); }
            80% { transform: translate(5px, 5px); }
            90% { transform: translate(-2px, 2px); }
        }
        
        .difficulty-easy { color: #00ff00; }
        .difficulty-medium { color: #ffaa00; }
        .difficulty-hard { color: #ff0000; }
        
        /* ç‚¸å¼¹Canvasæ ·å¼ */
        #bomb-canvas {
            border-radius: 50%;
            box-shadow: 0 0 50px rgba(255, 0, 0, 0.5);
        }
        
        /* ç«èŠ±æ•ˆæœ */
        .spark {
            position: absolute;
            width: 4px;
            height: 4px;
            background: radial-gradient(circle, #ffff00 0%, #ff6600 50%, transparent 100%);
            border-radius: 50%;
            pointer-events: none;
            animation: spark-fly 0.8s ease-out forwards;
        }
        
        @keyframes spark-fly {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) scale(0);
                opacity: 0;
            }
        }
        
        /* çƒŸé›¾æ•ˆæœ */
        .smoke {
            position: absolute;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, rgba(100,100,100,0.8) 0%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
            animation: smoke-rise 2s ease-out forwards;
        }
        
        @keyframes smoke-rise {
            0% {
                transform: translateY(0) scale(0.5);
                opacity: 0.8;
            }
            100% {
                transform: translateY(-100px) scale(3);
                opacity: 0;
            }
        }
        
        /* å‰ªåˆ€å…‰æ ‡åŠ¨ç”» */
        .cutting {
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="%23ff0000" stroke-width="2"><circle cx="6" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><line x1="20" y1="4" x2="8.12" y2="15.88"/><line x1="14.47" y1="14.48" x2="20" y2="20"/><line x1="8.12" y1="8.12" x2="12" y2="12"/></svg>') 16 16, pointer;
        }
        
        /* ç‚¸å¼¹éœ‡åŠ¨ */
        .bomb-shake {
            animation: bombShake 0.1s infinite;
        }
        
        @keyframes bombShake {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(-2px, 2px) rotate(-1deg); }
            50% { transform: translate(2px, -2px) rotate(1deg); }
            75% { transform: translate(-2px, -2px) rotate(-1deg); }
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center crt-flicker">
    <div class="scanline"></div>
    <div class="explosion" id="explosion"></div>
    <div class="shockwave" id="shockwave"></div>
    <div id="fire-container" class="fixed inset-0 pointer-events-none z-50"></div>
    
    <!-- èƒŒæ™¯äºŒè¿›åˆ¶ä»£ç  -->
    <div id="binary-bg" class="fixed inset-0 overflow-hidden pointer-events-none"></div>
    
    <!-- ä¸»æ¸¸æˆå®¹å™¨ -->
    <div class="relative w-full max-w-7xl mx-4">
        
        <!-- å¼€å§‹ç•Œé¢ -->
        <div id="start-screen" class="module rounded-lg p-8 pulse-red relative">
            <div class="panel-corner tl"></div>
            <div class="panel-corner tr"></div>
            <div class="panel-corner bl"></div>
            <div class="panel-corner br"></div>
            
            <div class="text-center">
                <h1 class="text-6xl font-bold mb-4 glitch">
                    <span class="warning-text">âš ï¸ æ‹†å¼¹ä¸“å®¶ âš ï¸</span>
                </h1>
                <p class="text-gray-400 text-xl mb-2">BOMB DEFUSAL EXPERT</p>
                <div class="h-1 w-64 mx-auto bg-gradient-to-r from-transparent via-red-500 to-transparent mb-8"></div>
                
                <!-- ç‚¸å¼¹é¢„è§ˆ -->
                <div class="flex justify-center mb-8">
                    <canvas id="preview-bomb" width="200" height="200"></canvas>
                </div>
                
                <div class="mb-8">
                    <p class="text-red-400 text-lg mb-4">ç›®æ ‡æ—¶é—´: ä¸‹åˆ 6:00:00</p>
                    <p class="text-gray-300 mb-2">ä½ åªæœ‰ <span class="warning-text">3 æ¬¡æœºä¼š</span> æ‹†é™¤ç‚¸å¼¹</p>
                    <p class="text-gray-400 text-sm">åœ¨æ—¶é—´è€—å°½å‰å®Œæˆæ‰€æœ‰æ‹†å¼¹æ¨¡å—</p>
                </div>
                
                <div class="mb-8">
                    <p class="text-gray-300 mb-4">é€‰æ‹©éš¾åº¦ç­‰çº§:</p>
                    <div class="flex justify-center gap-4">
                        <button onclick="startGame('easy')" class="btn-tech px-8 py-4 rounded difficulty-easy border-green-500">
                            <div class="text-2xl">ç®€å•</div>
                            <div class="text-xs text-gray-400">EASY</div>
                        </button>
                        <button onclick="startGame('medium')" class="btn-tech px-8 py-4 rounded difficulty-medium border-yellow-500">
                            <div class="text-2xl">ä¸­ç­‰</div>
                            <div class="text-xs text-gray-400">MEDIUM</div>
                        </button>
                        <button onclick="startGame('hard')" class="btn-tech px-8 py-4 rounded difficulty-hard border-red-500">
                            <div class="text-2xl">å›°éš¾</div>
                            <div class="text-xs text-gray-400">HARD</div>
                        </button>
                    </div>
                </div>
                
                <div class="text-gray-500 text-sm">
                    <p>âš ï¸ è­¦å‘Š: æœ¬æ¸¸æˆåŒ…å«ç´§å¼ åˆºæ¿€çš„å†…å®¹ âš ï¸</p>
                    <p class="mt-2">è¯·ç¡®ä¿ä½ æœ‰è¶³å¤Ÿçš„å¿ƒç†æ‰¿å—èƒ½åŠ›</p>
                </div>
            </div>
        </div>
        
        <!-- æ¸¸æˆä¸»ç•Œé¢ -->
        <div id="game-screen" class="hidden">
            <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
            <div class="module rounded-lg p-4 mb-4 flex justify-between items-center">
                <div class="flex items-center gap-6">
                    <div>
                        <span class="text-gray-400 text-sm">å‰©ä½™æœºä¼š</span>
                        <div class="flex gap-2 mt-1" id="lives-display">
                            <div class="led active"></div>
                            <div class="led active"></div>
                            <div class="led active"></div>
                        </div>
                    </div>
                    <div>
                        <span class="text-gray-400 text-sm">éš¾åº¦</span>
                        <div id="difficulty-display" class="text-xl font-bold"></div>
                    </div>
                </div>
                
                <div class="text-center">
                    <div class="text-gray-400 text-sm mb-1">è·ç¦»çˆ†ç‚¸è¿˜æœ‰</div>
                    <div id="countdown" class="text-4xl font-bold timer-glow text-red-500">00:00:00.000</div>
                </div>
                
                <div class="text-right">
                    <div class="text-gray-400 text-sm">å·²è§£å†³æ¨¡å—</div>
                    <div class="text-2xl safe-text"><span id="solved-count">0</span> / <span id="total-modules">3</span></div>
                </div>
            </div>
            
            <!-- ç‚¸å¼¹å±•ç¤ºåŒº -->
            <div class="flex justify-center mb-6">
                <div id="bomb-container" class="relative">
                    <canvas id="bomb-canvas" width="400" height="400"></canvas>
                    <div id="sparks-container" class="absolute inset-0 pointer-events-none"></div>
                </div>
            </div>
            
            <!-- æ¸¸æˆåŒºåŸŸ -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                
                <!-- å‰ªçº¿æ¨¡å— -->
                <div id="wire-module" class="module rounded-lg p-6 relative">
                    <div class="panel-corner tl"></div>
                    <div class="panel-corner tr"></div>
                    <div class="panel-corner bl"></div>
                    <div class="panel-corner br"></div>
                    
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl warning-text">âš¡ å‰ªçº¿æ¨¡å—</h3>
                        <div class="led" id="wire-status"></div>
                    </div>
                    
                    <div class="bg-black rounded p-4 mb-4">
                        <p class="text-gray-400 text-sm mb-2">æŒ‡ä»¤:</p>
                        <p id="wire-instruction" class="text-yellow-400 text-sm"></p>
                    </div>
                    
                    <div id="wires-container" class="space-y-3">
                        <!-- åŠ¨æ€ç”Ÿæˆç”µçº¿ -->
                    </div>
                    
                    <div id="wire-result" class="mt-4 text-center hidden"></div>
                </div>
                
                <!-- å¯†ç æ¨¡å— -->
                <div id="code-module" class="module rounded-lg p-6 relative">
                    <div class="panel-corner tl"></div>
                    <div class="panel-corner tr"></div>
                    <div class="panel-corner bl"></div>
                    <div class="panel-corner br"></div>
                    
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl warning-text">ğŸ” å¯†ç æ¨¡å—</h3>
                        <div class="led" id="code-status"></div>
                    </div>
                    
                    <div class="bg-black rounded p-4 mb-4">
                        <p class="text-gray-400 text-sm mb-2">æç¤º:</p>
                        <p id="code-hint" class="text-cyan-400 text-sm"></p>
                    </div>
                    
                    <div class="mb-4">
                        <input type="text" id="code-input" class="code-input w-full px-4 py-3 text-2xl text-center rounded" maxlength="4" placeholder="????" readonly>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-2">
                        <button onclick="enterDigit('1')" class="btn-tech py-3 rounded text-xl">1</button>
                        <button onclick="enterDigit('2')" class="btn-tech py-3 rounded text-xl">2</button>
                        <button onclick="enterDigit('3')" class="btn-tech py-3 rounded text-xl">3</button>
                        <button onclick="enterDigit('4')" class="btn-tech py-3 rounded text-xl">4</button>
                        <button onclick="enterDigit('5')" class="btn-tech py-3 rounded text-xl">5</button>
                        <button onclick="enterDigit('6')" class="btn-tech py-3 rounded text-xl">6</button>
                        <button onclick="enterDigit('7')" class="btn-tech py-3 rounded text-xl">7</button>
                        <button onclick="enterDigit('8')" class="btn-tech py-3 rounded text-xl">8</button>
                        <button onclick="enterDigit('9')" class="btn-tech py-3 rounded text-xl">9</button>
                        <button onclick="clearCode()" class="btn-tech py-3 rounded text-xl text-red-400">C</button>
                        <button onclick="enterDigit('0')" class="btn-tech py-3 rounded text-xl">0</button>
                        <button onclick="submitCode()" class="btn-tech py-3 rounded text-xl text-green-400">âœ“</button>
                    </div>
                    
                    <div id="code-result" class="mt-4 text-center hidden"></div>
                </div>
                
                <!-- å¼€å…³æ¨¡å— -->
                <div id="switch-module" class="module rounded-lg p-6 relative">
                    <div class="panel-corner tl"></div>
                    <div class="panel-corner tr"></div>
                    <div class="panel-corner bl"></div>
                    <div class="panel-corner br"></div>
                    
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl warning-text">ğŸ”Œ å¼€å…³æ¨¡å—</h3>
                        <div class="led" id="switch-status"></div>
                    </div>
                    
                    <div class="bg-black rounded p-4 mb-4">
                        <p class="text-gray-400 text-sm mb-2">ç›®æ ‡çŠ¶æ€:</p>
                        <p id="switch-instruction" class="text-purple-400 text-sm"></p>
                    </div>
                    
                    <div id="switches-container" class="space-y-4">
                        <!-- åŠ¨æ€ç”Ÿæˆå¼€å…³ -->
                    </div>
                    
                    <div class="mt-4">
                        <button onclick="checkSwitches()" class="btn-tech w-full py-3 rounded text-lg">ç¡®è®¤å¼€å…³çŠ¶æ€</button>
                    </div>
                    
                    <div id="switch-result" class="mt-4 text-center hidden"></div>
                </div>
            </div>
            
            <!-- ç³»ç»Ÿæ—¥å¿— -->
            <div class="module rounded-lg p-4 mt-4">
                <h4 class="text-gray-400 text-sm mb-2">ğŸ“‹ ç³»ç»Ÿæ—¥å¿—</h4>
                <div id="system-log" class="h-32 overflow-y-auto text-sm space-y-1 font-mono">
                    <div class="log-entry text-gray-500">[ç³»ç»Ÿ] ç‚¸å¼¹å·²å¯åŠ¨...</div>
                    <div class="log-entry text-gray-500">[ç³»ç»Ÿ] ç­‰å¾…æ‹†å¼¹æ“ä½œ...</div>
                </div>
            </div>
        </div>
        
        <!-- æ¸¸æˆç»“æŸç•Œé¢ -->
        <div id="end-screen" class="hidden module rounded-lg p-8 text-center relative">
            <div class="panel-corner tl"></div>
            <div class="panel-corner tr"></div>
            <div class="panel-corner bl"></div>
            <div class="panel-corner br"></div>
            
            <div id="end-icon" class="text-8xl mb-4"></div>
            <h2 id="end-title" class="text-5xl font-bold mb-4"></h2>
            <p id="end-message" class="text-xl mb-8"></p>
            
            <div class="mb-8">
                <p class="text-gray-400">æœ€ç»ˆç»Ÿè®¡</p>
                <div class="flex justify-center gap-8 mt-4">
                    <div>
                        <div class="text-gray-400 text-sm">å‰©ä½™æ—¶é—´</div>
                        <div id="final-time" class="text-2xl"></div>
                    </div>
                    <div>
                        <div class="text-gray-400 text-sm">è§£å†³æ¨¡å—</div>
                        <div id="final-modules" class="text-2xl safe-text"></div>
                    </div>
                    <div>
                        <div class="text-gray-400 text-sm">å‰©ä½™æœºä¼š</div>
                        <div id="final-lives" class="text-2xl warning-text"></div>
                    </div>
                </div>
            </div>
            
            <button onclick="location.reload()" class="btn-tech px-8 py-4 rounded text-xl">
                å†æ¬¡æŒ‘æˆ˜
            </button>
        </div>
    </div>
    
    <script>
        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            difficulty: 'easy',
            lives: 3,
            modulesSolved: 0,
            totalModules: 3,
            targetTime: null,
            timeRemaining: 0, // ç°åœ¨ä»¥ç§’ä¸ºå•ä½ï¼Œä½†åŒ…å«å°æ•°è¡¨ç¤ºæ¯«ç§’
            lastUpdateTime: 0,
            timerInterval: null,
            wireSolved: false,
            codeSolved: false,
            switchSolved: false,
            currentCode: '',
            targetCode: '',
            wireOrder: [],
            correctWire: -1,
            switchStates: [],
            targetSwitchStates: [],
            bombShakeIntensity: 0,
            sparkInterval: null
        };
        
        // éš¾åº¦é…ç½®
        const difficultyConfig = {
            easy: {
                name: 'ç®€å•',
                class: 'difficulty-easy',
                timeMultiplier: 1.5,
                wireCount: 4,
                switchCount: 3
            },
            medium: {
                name: 'ä¸­ç­‰',
                class: 'difficulty-medium',
                timeMultiplier: 1,
                wireCount: 5,
                switchCount: 4
            },
            hard: {
                name: 'å›°éš¾',
                class: 'difficulty-hard',
                timeMultiplier: 0.7,
                wireCount: 6,
                switchCount: 5
            }
        };
        
        // ç”µçº¿é¢œè‰²
        const wireColors = [
            { name: 'çº¢è‰²', color: '#ff0000', bg: 'bg-red-600' },
            { name: 'è“è‰²', color: '#0066ff', bg: 'bg-blue-600' },
            { name: 'é»„è‰²', color: '#ffcc00', bg: 'bg-yellow-500' },
            { name: 'ç™½è‰²', color: '#ffffff', bg: 'bg-gray-200' },
            { name: 'é»‘è‰²', color: '#333333', bg: 'bg-gray-800' },
            { name: 'ç»¿è‰²', color: '#00ff00', bg: 'bg-green-500' }
        ];
        
        // éŸ³é¢‘ä¸Šä¸‹æ–‡
        let audioContext = null;
        
        // åˆå§‹åŒ–éŸ³é¢‘
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }
        
        // æ’­æ”¾éŸ³æ•ˆ
        function playSound(type) {
            if (!audioContext) initAudio();
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            const now = audioContext.currentTime;
            
            switch(type) {
                case 'cut':
                    // å‰ªåˆ€å£°
                    oscillator.type = 'sawtooth';
                    oscillator.frequency.setValueAtTime(800, now);
                    oscillator.frequency.exponentialRampToValueAtTime(400, now + 0.1);
                    gainNode.gain.setValueAtTime(0.3, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                    oscillator.start(now);
                    oscillator.stop(now + 0.1);
                    break;
                    
                case 'beep':
                    // æŒ‰é”®å£°
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(1200, now);
                    gainNode.gain.setValueAtTime(0.2, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.05);
                    oscillator.start(now);
                    oscillator.stop(now + 0.05);
                    break;
                    
                case 'error':
                    // é”™è¯¯å£°
                    oscillator.type = 'sawtooth';
                    oscillator.frequency.setValueAtTime(150, now);
                    oscillator.frequency.linearRampToValueAtTime(100, now + 0.3);
                    gainNode.gain.setValueAtTime(0.4, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
                    oscillator.start(now);
                    oscillator.stop(now + 0.3);
                    break;
                    
                case 'success':
                    // æˆåŠŸå£°
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(523.25, now);
                    oscillator.frequency.setValueAtTime(659.25, now + 0.1);
                    oscillator.frequency.setValueAtTime(783.99, now + 0.2);
                    gainNode.gain.setValueAtTime(0.3, now);
                    gainNode.gain.linearRampToValueAtTime(0, now + 0.4);
                    oscillator.start(now);
                    oscillator.stop(now + 0.4);
                    break;
                    
                case 'tick':
                    // æ»´ç­”å£°
                    oscillator.type = 'square';
                    oscillator.frequency.setValueAtTime(1000, now);
                    gainNode.gain.setValueAtTime(0.1, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.02);
                    oscillator.start(now);
                    oscillator.stop(now + 0.02);
                    break;
                    
                case 'explosion':
                    // çˆ†ç‚¸å£°
                    oscillator.type = 'sawtooth';
                    oscillator.frequency.setValueAtTime(100, now);
                    oscillator.frequency.exponentialRampToValueAtTime(20, now + 1);
                    gainNode.gain.setValueAtTime(0.8, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, now + 1.5);
                    oscillator.start(now);
                    oscillator.stop(now + 1.5);
                    break;
                    
                case 'spark':
                    // ç«èŠ±å£°
                    oscillator.type = 'square';
                    oscillator.frequency.setValueAtTime(2000 + Math.random() * 1000, now);
                    gainNode.gain.setValueAtTime(0.1, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.05);
                    oscillator.start(now);
                    oscillator.stop(now + 0.05);
                    break;
            }
        }
        
        // ç‚¸å¼¹Canvasç»˜åˆ¶
        function drawBomb(canvas, timeProgress = 0, isShaking = false) {
            const ctx = canvas.getContext('2d');
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = 140; // å¢å¤§ç‚¸å¼¹åŠå¾„
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // éœ‡åŠ¨åç§»
            let offsetX = 0, offsetY = 0;
            if (isShaking) {
                offsetX = (Math.random() - 0.5) * gameState.bombShakeIntensity;
                offsetY = (Math.random() - 0.5) * gameState.bombShakeIntensity;
            }
            
            ctx.save();
            ctx.translate(centerX + offsetX, centerY + offsetY);
            
            // ç‚¸å¼¹ä¸»ä½“é˜´å½±
            ctx.beginPath();
            ctx.arc(8, 8, radius, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
            ctx.fill();
            
            // ç‚¸å¼¹ä¸»ä½“æ¸å˜
            const gradient = ctx.createRadialGradient(-30, -30, 0, 0, 0, radius);
            gradient.addColorStop(0, '#555');
            gradient.addColorStop(0.3, '#333');
            gradient.addColorStop(0.7, '#1a1a1a');
            gradient.addColorStop(1, '#000');
            
            ctx.beginPath();
            ctx.arc(0, 0, radius, 0, Math.PI * 2);
            ctx.fillStyle = gradient;
            ctx.fill();
            
            // é‡‘å±è¾¹æ¡†
            ctx.beginPath();
            ctx.arc(0, 0, radius, 0, Math.PI * 2);
            ctx.strokeStyle = '#888';
            ctx.lineWidth = 6;
            ctx.stroke();
            
            // å†…åœˆè£…é¥°çº¿
            ctx.beginPath();
            ctx.arc(0, 0, radius - 15, 0, Math.PI * 2);
            ctx.strokeStyle = '#444';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // é¡¶éƒ¨å¼•ä¿¡åº§
            ctx.fillStyle = '#2a2a2a';
            ctx.fillRect(-40, -radius - 25, 80, 35);
            
            // å¼•ä¿¡åº§è¾¹æ¡†
            ctx.strokeStyle = '#555';
            ctx.lineWidth = 3;
            ctx.strokeRect(-40, -radius - 25, 80, 35);
            
            // å¼•ä¿¡
            ctx.strokeStyle = '#8B4513';
            ctx.lineWidth = 12;
            ctx.lineCap = 'round';
            ctx.beginPath();
            ctx.moveTo(0, -radius - 25);
            ctx.quadraticCurveTo(30, -radius - 60, 60, -radius - 45);
            ctx.stroke();
            
            // å¼•ä¿¡ç«èŠ±
            if (timeProgress > 0.5) {
                const sparkX = 60;
                const sparkY = -radius - 45;
                const sparkGradient = ctx.createRadialGradient(sparkX, sparkY, 0, sparkX, sparkY, 15);
                sparkGradient.addColorStop(0, 'rgba(255, 255, 200, 1)');
                sparkGradient.addColorStop(0.3, 'rgba(255, 200, 0, 0.9)');
                sparkGradient.addColorStop(0.7, 'rgba(255, 100, 0, 0.6)');
                sparkGradient.addColorStop(1, 'rgba(255, 0, 0, 0)');
                
                ctx.beginPath();
                ctx.arc(sparkX, sparkY, 15, 0, Math.PI * 2);
                ctx.fillStyle = sparkGradient;
                ctx.fill();
            }
            
            // ç«èŠ±ï¼ˆæ ¹æ®æ—¶é—´è¿›åº¦å¢åŠ ï¼‰
            const sparkCount = Math.floor(timeProgress * 15);
            for (let i = 0; i < sparkCount; i++) {
                const angle = Math.random() * Math.PI * 2;
                const distance = radius + 15 + Math.random() * 40;
                const x = Math.cos(angle) * distance;
                const y = Math.sin(angle) * distance;
                const size = 3 + Math.random() * 6;
                
                // ç«èŠ±å…‰æ™•
                const sparkGradient = ctx.createRadialGradient(x, y, 0, x, y, size * 2);
                sparkGradient.addColorStop(0, 'rgba(255, 255, 0, 1)');
                sparkGradient.addColorStop(0.5, 'rgba(255, 100, 0, 0.8)');
                sparkGradient.addColorStop(1, 'rgba(255, 0, 0, 0)');
                
                ctx.beginPath();
                ctx.arc(x, y, size * 2, 0, Math.PI * 2);
                ctx.fillStyle = sparkGradient;
                ctx.fill();
            }
            
            // ä¸­å¿ƒæ˜¾ç¤ºå± - å¢å¤§å°ºå¯¸
            ctx.fillStyle = '#000';
            ctx.fillRect(-90, -50, 180, 100);
            
            // æ˜¾ç¤ºå±è¾¹æ¡†
            ctx.strokeStyle = '#444';
            ctx.lineWidth = 4;
            ctx.strokeRect(-90, -50, 180, 100);
            
            // å†…è¾¹æ¡†
            ctx.strokeStyle = '#222';
            ctx.lineWidth = 2;
            ctx.strokeRect(-85, -45, 170, 90);
            
            // å€’è®¡æ—¶æ•°å­— - åŒ…å«æ¯«ç§’
            const hours = Math.floor(gameState.timeRemaining / 3600);
            const minutes = Math.floor((gameState.timeRemaining % 3600) / 60);
            const seconds = Math.floor(gameState.timeRemaining % 60);
            const milliseconds = Math.floor((gameState.timeRemaining % 1) * 1000);
            const timeStr = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}.${String(milliseconds).padStart(3, '0')}`;
            
            ctx.font = 'bold 36px "Share Tech Mono", monospace';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            // æ–‡å­—å‘å…‰æ•ˆæœ
            ctx.shadowColor = '#ff0000';
            ctx.shadowBlur = 30;
            ctx.fillStyle = '#ff0000';
            ctx.fillText(timeStr, 0, 5);
            
            // æ¯«ç§’å°æ•°ç‚¹é—ªçƒæ•ˆæœ
            if (Math.floor(Date.now() / 200) % 2 === 0) {
                ctx.fillStyle = '#ff3333';
                ctx.fillText('.', 2, 5);
            }
            
            ctx.shadowBlur = 0;
            
            // LEDæŒ‡ç¤ºç¯ - å¢å¤§å¹¶é‡æ–°å®šä½
            const ledColors = ['#ff0000', '#ff0000', '#ff0000'];
            for (let i = 0; i < gameState.lives; i++) {
                ledColors[i] = '#00ff00';
            }
            
            for (let i = 0; i < 3; i++) {
                const ledX = -70 + i * 70;
                const ledY = -85;
                
                // LEDå¤–åœˆ
                ctx.beginPath();
                ctx.arc(ledX, ledY, 10, 0, Math.PI * 2);
                ctx.fillStyle = '#222';
                ctx.fill();
                ctx.strokeStyle = '#444';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // LEDç¯
                ctx.beginPath();
                ctx.arc(ledX, ledY, 7, 0, Math.PI * 2);
                ctx.fillStyle = ledColors[i];
                ctx.shadowColor = ledColors[i];
                ctx.shadowBlur = 15;
                ctx.fill();
                ctx.shadowBlur = 0;
            }
            
            // è­¦å‘Šæ¡çº¹ - å¢å¤§
            ctx.save();
            ctx.rotate(Math.PI / 4);
            for (let i = -5; i <= 5; i++) {
                ctx.fillStyle = i % 2 === 0 ? '#ffcc00' : '#000';
                ctx.fillRect(i * 25 - 12, -radius - 15, 20, 12);
            }
            ctx.restore();
            
            ctx.restore();
        }
        
        // åˆ›å»ºç«èŠ±ç²’å­
        function createSpark(x, y, intensity = 1) {
            const container = document.getElementById('sparks-container');
            const sparkCount = 5 * intensity;
            
            for (let i = 0; i < sparkCount; i++) {
                const spark = document.createElement('div');
                spark.className = 'spark';
                
                const angle = Math.random() * Math.PI * 2;
                const distance = 50 + Math.random() * 100;
                const tx = Math.cos(angle) * distance;
                const ty = Math.sin(angle) * distance;
                
                spark.style.left = x + 'px';
                spark.style.top = y + 'px';
                spark.style.setProperty('--tx', tx + 'px');
                spark.style.setProperty('--ty', ty + 'px');
                
                container.appendChild(spark);
                
                setTimeout(() => spark.remove(), 800);
            }
            
            // æ’­æ”¾ç«èŠ±éŸ³æ•ˆ
            if (Math.random() > 0.7) {
                playSound('spark');
            }
        }
        
        // åˆ›å»ºçƒŸé›¾
        function createSmoke(x, y) {
            const container = document.getElementById('sparks-container');
            
            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    const smoke = document.createElement('div');
                    smoke.className = 'smoke';
                    smoke.style.left = (x + (Math.random() - 0.5) * 40) + 'px';
                    smoke.style.top = (y + (Math.random() - 0.5) * 40) + 'px';
                    container.appendChild(smoke);
                    setTimeout(() => smoke.remove(), 2000);
                }, i * 200);
            }
        }
        
        // å¼€å§‹ç«èŠ±æ•ˆæœ
        function startSparkEffect() {
            const canvas = document.getElementById('bomb-canvas');
            
            gameState.sparkInterval = setInterval(() => {
                if (gameState.timeRemaining <= 60) {
                    // æ—¶é—´ç´§è¿«æ—¶ç«èŠ±æ›´é¢‘ç¹
                    const intensity = gameState.timeRemaining <= 30 ? 2 : 1;
                    createSpark(200, 200, intensity);
                    gameState.bombShakeIntensity = gameState.timeRemaining <= 30 ? 10 : 6;
                    
                    // é‡ç»˜ç”»å¸ƒ
                    const timeProgress = 1 - (gameState.timeRemaining / 7200);
                    drawBomb(canvas, timeProgress, true);
                } else {
                    gameState.bombShakeIntensity = 0;
                    const timeProgress = 1 - (gameState.timeRemaining / 7200);
                    drawBomb(canvas, timeProgress, false);
                }
            }, 50); // æ”¹ä¸º50msä»¥å®ç°æ¯«ç§’çº§æ›´æ–°
        }
        
        // åˆå§‹åŒ–èƒŒæ™¯äºŒè¿›åˆ¶
        function initBinaryBackground() {
            const container = document.getElementById('binary-bg');
            for (let i = 0; i < 50; i++) {
                const span = document.createElement('span');
                span.className = 'binary-bg';
                span.style.left = Math.random() * 100 + '%';
                span.style.top = Math.random() * 100 + '%';
                span.textContent = Math.random() > 0.5 ? '1' : '0';
                span.style.animation = `pulseRed ${2 + Math.random() * 3}s infinite`;
                container.appendChild(span);
            }
        }
        
        // å¼€å§‹æ¸¸æˆ
        function startGame(difficulty) {
            // åˆå§‹åŒ–éŸ³é¢‘ï¼ˆéœ€è¦ç”¨æˆ·äº¤äº’ï¼‰
            initAudio();
            
            gameState.difficulty = difficulty;
            const config = difficultyConfig[difficulty];
            
            // è®¡ç®—ç›®æ ‡æ—¶é—´ï¼ˆä»Šå¤©ä¸‹åˆ6ç‚¹ï¼‰
            const now = new Date();
            gameState.targetTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 18, 0, 0);
            if (gameState.targetTime <= now) {
                gameState.targetTime.setDate(gameState.targetTime.getDate() + 1);
            }
            
            // æ ¹æ®éš¾åº¦è°ƒæ•´æ—¶é—´
            const baseTime = gameState.targetTime - now;
            gameState.timeRemaining = baseTime / 1000; // ä¿ç•™å°æ•°è¡¨ç¤ºæ¯«ç§’
            gameState.lastUpdateTime = Date.now();
            
            // æ˜¾ç¤ºæ¸¸æˆç•Œé¢
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            
            // æ›´æ–°éš¾åº¦æ˜¾ç¤º
            const diffDisplay = document.getElementById('difficulty-display');
            diffDisplay.textContent = config.name;
            diffDisplay.className = `text-xl font-bold ${config.class}`;
            
            document.getElementById('total-modules').textContent = gameState.totalModules;
            
            // åˆå§‹åŒ–ç‚¸å¼¹ç”»å¸ƒ
            const bombCanvas = document.getElementById('bomb-canvas');
            drawBomb(bombCanvas, 0, false);
            startSparkEffect();
            
            // åˆå§‹åŒ–æ¨¡å—
            initWireModule();
            initCodeModule();
            initSwitchModule();
            
            // å¯åŠ¨å€’è®¡æ—¶
            startTimer();
            
            addLog('æ¸¸æˆå¼€å§‹ï¼éš¾åº¦: ' + config.name, 'warning');
            addLog('ç‚¸å¼¹å·²æ¿€æ´»ï¼Œè¯·å°½å¿«æ‹†é™¤ï¼', 'danger');
            
            // æ’­æ”¾å¯åŠ¨éŸ³æ•ˆ
            playSound('success');
        }
        
        // å¯åŠ¨è®¡æ—¶å™¨ - ä½¿ç”¨requestAnimationFrameå®ç°æ¯«ç§’çº§ç²¾åº¦
        function startTimer() {
            updateTimerDisplay();
            
            function tick() {
                const now = Date.now();
                const deltaTime = (now - gameState.lastUpdateTime) / 1000;
                gameState.lastUpdateTime = now;
                
                gameState.timeRemaining -= deltaTime;
                
                // æ¯100msæ›´æ–°ä¸€æ¬¡æ˜¾ç¤º
                updateTimerDisplay();
                
                // æ¯ç§’æ’­æ”¾ä¸€æ¬¡æ»´ç­”å£°
                const currentSecond = Math.floor(gameState.timeRemaining);
                if (currentSecond <= 60 && currentSecond !== gameState.lastTickSecond) {
                    gameState.lastTickSecond = currentSecond;
                    playSound('tick');
                }
                
                if (gameState.timeRemaining <= 0) {
                    gameOver(false, 'æ—¶é—´è€—å°½ï¼ç‚¸å¼¹çˆ†ç‚¸äº†ï¼');
                    return;
                } else if (gameState.timeRemaining <= 60) {
                    document.getElementById('countdown').classList.add('pulse-warning');
                }
                
                gameState.timerInterval = requestAnimationFrame(tick);
            }
            
            gameState.lastTickSecond = Math.floor(gameState.timeRemaining);
            gameState.timerInterval = requestAnimationFrame(tick);
        }
        
        // æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º - åŒ…å«æ¯«ç§’
        function updateTimerDisplay() {
            const hours = Math.floor(gameState.timeRemaining / 3600);
            const minutes = Math.floor((gameState.timeRemaining % 3600) / 60);
            const seconds = Math.floor(gameState.timeRemaining % 60);
            const milliseconds = Math.floor((gameState.timeRemaining % 1) * 1000);
            
            const display = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}.${String(milliseconds).padStart(3, '0')}`;
            document.getElementById('countdown').textContent = display;
        }
        
        // åˆå§‹åŒ–å‰ªçº¿æ¨¡å—
        function initWireModule() {
            const config = difficultyConfig[gameState.difficulty];
            const container = document.getElementById('wires-container');
            container.innerHTML = '';
            
            // éšæœºé€‰æ‹©ç”µçº¿
            const wireCount = config.wireCount;
            gameState.wireOrder = [];
            const usedColors = [];
            
            for (let i = 0; i < wireCount; i++) {
                let color;
                do {
                    color = wireColors[Math.floor(Math.random() * wireColors.length)];
                } while (usedColors.includes(color.name));
                usedColors.push(color.name);
                gameState.wireOrder.push(color);
            }
            
            // ç¡®å®šæ­£ç¡®çš„ç”µçº¿
            const colorCounts = {};
            gameState.wireOrder.forEach(w => {
                colorCounts[w.name] = (colorCounts[w.name] || 0) + 1;
            });
            
            // æ ¹æ®è§„åˆ™é€‰æ‹©æ­£ç¡®çš„ç”µçº¿
            const rules = [
                'å¦‚æœæœ€åä¸€æ ¹æ˜¯çº¢è‰²ï¼Œå‰ªç¬¬ä¸‰æ ¹',
                'å¦‚æœè“è‰²ç”µçº¿å¤šäºä¸€æ ¹ï¼Œå‰ªæœ€åä¸€æ ¹è“è‰²',
                'å¦‚æœé»„è‰²ç”µçº¿æ˜¯å¥‡æ•°ï¼Œå‰ªç¬¬ä¸€æ ¹',
                'å¦åˆ™ï¼Œå‰ªæœ€åä¸€æ ¹'
            ];
            
            const ruleIndex = Math.floor(Math.random() * rules.length);
            document.getElementById('wire-instruction').textContent = rules[ruleIndex];
            
            // æ ¹æ®è§„åˆ™ç¡®å®šæ­£ç¡®ç­”æ¡ˆ
            if (ruleIndex === 0 && gameState.wireOrder[wireCount - 1].name === 'çº¢è‰²') {
                gameState.correctWire = 2;
            } else if (ruleIndex === 1 && (colorCounts['è“è‰²'] || 0) > 1) {
                for (let i = wireCount - 1; i >= 0; i--) {
                    if (gameState.wireOrder[i].name === 'è“è‰²') {
                        gameState.correctWire = i;
                        break;
                    }
                }
            } else if (ruleIndex === 2 && ((colorCounts['é»„è‰²'] || 0) % 2 === 1)) {
                gameState.correctWire = 0;
            } else {
                gameState.correctWire = wireCount - 1;
            }
            
            // åˆ›å»ºç”µçº¿
            gameState.wireOrder.forEach((wire, index) => {
                const wireDiv = document.createElement('div');
                wireDiv.className = 'wire flex items-center gap-4 p-3 rounded bg-gray-900';
                wireDiv.onclick = () => cutWire(index);
                wireDiv.innerHTML = `
                    <div class="w-8 h-8 rounded-full ${wire.bg} border-2 border-gray-600 shadow-lg" style="box-shadow: 0 0 10px ${wire.color}"></div>
                    <div class="flex-1 h-4 rounded ${wire.bg}" style="background: linear-gradient(90deg, ${wire.color} 0%, ${wire.color}dd 50%, ${wire.color} 100%)"></div>
                    <span class="text-gray-400 text-sm">#${index + 1}</span>
                `;
                container.appendChild(wireDiv);
            });
        }
        
        // å‰ªçº¿
        function cutWire(index) {
            if (gameState.wireSolved) return;
            
            // æ’­æ”¾å‰ªçº¿éŸ³æ•ˆ
            playSound('cut');
            
            const wires = document.getElementById('wires-container').children;
            wires[index].classList.add('cut');
            
            // åˆ›å»ºç«èŠ±æ•ˆæœ
            const rect = wires[index].getBoundingClientRect();
            const containerRect = document.getElementById('sparks-container').getBoundingClientRect();
            createSpark(rect.left - containerRect.left + rect.width / 2, rect.top - containerRect.top + rect.height / 2, 2);
            
            if (index === gameState.correctWire) {
                gameState.wireSolved = true;
                gameState.modulesSolved++;
                document.getElementById('wire-status').classList.add('safe');
                document.getElementById('solved-count').textContent = gameState.modulesSolved;
                document.getElementById('wire-result').innerHTML = '<span class="safe-text">âœ“ æ¨¡å—å·²è§£é™¤</span>';
                document.getElementById('wire-result').classList.remove('hidden');
                addLog('å‰ªçº¿æ¨¡å—å·²è§£é™¤ï¼', 'success');
                playSound('success');
                checkWin();
            } else {
                // åˆ›å»ºçƒŸé›¾æ•ˆæœ
                createSmoke(rect.left - containerRect.left + rect.width / 2, rect.top - containerRect.top + rect.height / 2);
                loseLife('å‰ªé”™ç”µçº¿ï¼');
            }
        }
        
        // åˆå§‹åŒ–å¯†ç æ¨¡å—
        function initCodeModule() {
            // ç”Ÿæˆç›®æ ‡å¯†ç 
            gameState.targetCode = String(Math.floor(Math.random() * 10000)).padStart(4, '0');
            
            // ç”Ÿæˆæç¤º
            const hints = [
                `ç¬¬ä¸€ä½æ˜¯ ${gameState.targetCode[0]}`,
                `æœ€åä¸€ä½æ˜¯ ${gameState.targetCode[3]}`,
                `å››ä½æ•°å­—ä¹‹å’Œæ˜¯ ${gameState.targetCode.split('').reduce((a, b) => a + parseInt(b), 0)}`,
                `å¯†ç åœ¨ ${parseInt(gameState.targetCode) - 50} åˆ° ${parseInt(gameState.targetCode) + 50} ä¹‹é—´`
            ];
            
            const hintIndex = Math.floor(Math.random() * hints.length);
            document.getElementById('code-hint').textContent = hints[hintIndex];
            
            gameState.currentCode = '';
            document.getElementById('code-input').value = '';
        }
        
        // è¾“å…¥æ•°å­—
        function enterDigit(digit) {
            if (gameState.codeSolved || gameState.currentCode.length >= 4) return;
            
            playSound('beep');
            gameState.currentCode += digit;
            document.getElementById('code-input').value = gameState.currentCode;
        }
        
        // æ¸…é™¤å¯†ç 
        function clearCode() {
            if (gameState.codeSolved) return;
            
            playSound('beep');
            gameState.currentCode = '';
            document.getElementById('code-input').value = '';
        }
        
        // æäº¤å¯†ç 
        function submitCode() {
            if (gameState.codeSolved) return;
            
            if (gameState.currentCode === gameState.targetCode) {
                gameState.codeSolved = true;
                gameState.modulesSolved++;
                document.getElementById('code-status').classList.add('safe');
                document.getElementById('code-result').innerHTML = '<span class="safe-text">âœ“ å¯†ç æ­£ç¡®</span>';
                document.getElementById('code-result').classList.remove('hidden');
                document.getElementById('code-input').classList.add('safe-text');
                addLog('å¯†ç æ¨¡å—å·²è§£é™¤ï¼', 'success');
                playSound('success');
                checkWin();
            } else {
                playSound('error');
                loseLife('å¯†ç é”™è¯¯ï¼');
                gameState.currentCode = '';
                document.getElementById('code-input').value = '';
            }
        }
        
        // åˆå§‹åŒ–å¼€å…³æ¨¡å—
        function initSwitchModule() {
            const config = difficultyConfig[gameState.difficulty];
            const container = document.getElementById('switches-container');
            container.innerHTML = '';
            
            const switchCount = config.switchCount;
            gameState.switchStates = new Array(switchCount).fill(false);
            gameState.targetSwitchStates = [];
            
            // ç”Ÿæˆç›®æ ‡çŠ¶æ€
            for (let i = 0; i < switchCount; i++) {
                gameState.targetSwitchStates.push(Math.random() > 0.5);
            }
            
            // æ˜¾ç¤ºæç¤º
            const onCount = gameState.targetSwitchStates.filter(s => s).length;
            document.getElementById('switch-instruction').textContent = `å¼€å¯ ${onCount} ä¸ªå¼€å…³ï¼Œå…³é—­ ${switchCount - onCount} ä¸ªå¼€å…³`;
            
            // åˆ›å»ºå¼€å…³
            for (let i = 0; i < switchCount; i++) {
                const switchDiv = document.createElement('div');
                switchDiv.className = 'flex items-center justify-between bg-gray-900 p-3 rounded';
                switchDiv.innerHTML = `
                    <span class="text-gray-400">å¼€å…³ ${i + 1}</span>
                    <label class="switch">
                        <input type="checkbox" id="switch-${i}" onchange="toggleSwitch(${i})">
                        <span class="slider"></span>
                    </label>
                `;
                container.appendChild(switchDiv);
            }
        }
        
        // åˆ‡æ¢å¼€å…³
        function toggleSwitch(index) {
            if (gameState.switchSolved) return;
            
            playSound('beep');
            gameState.switchStates[index] = document.getElementById(`switch-${index}`).checked;
        }
        
        // æ£€æŸ¥å¼€å…³
        function checkSwitches() {
            if (gameState.switchSolved) return;
            
            const correct = gameState.switchStates.every((state, index) => 
                state === gameState.targetSwitchStates[index]
            );
            
            if (correct) {
                gameState.switchSolved = true;
                gameState.modulesSolved++;
                document.getElementById('switch-status').classList.add('safe');
                document.getElementById('switch-result').innerHTML = '<span class="safe-text">âœ“ å¼€å…³é…ç½®æ­£ç¡®</span>';
                document.getElementById('switch-result').classList.remove('hidden');
                addLog('å¼€å…³æ¨¡å—å·²è§£é™¤ï¼', 'success');
                playSound('success');
                checkWin();
            } else {
                playSound('error');
                loseLife('å¼€å…³é…ç½®é”™è¯¯ï¼');
            }
        }
        
        // å¤±å»ç”Ÿå‘½
        function loseLife(reason) {
            gameState.lives--;
            updateLivesDisplay();
            
            // éœ‡åŠ¨æ•ˆæœ
            document.body.classList.add('shake');
            document.getElementById('bomb-container').classList.add('bomb-shake');
            setTimeout(() => {
                document.body.classList.remove('shake');
                document.getElementById('bomb-container').classList.remove('bomb-shake');
            }, 500);
            
            // æ’­æ”¾é”™è¯¯éŸ³æ•ˆ
            playSound('error');
            
            addLog(`é”™è¯¯ï¼${reason}`, 'danger');
            addLog(`å‰©ä½™æœºä¼š: ${gameState.lives}`, 'warning');
            
            if (gameState.lives <= 0) {
                gameOver(false, 'æœºä¼šè€—å°½ï¼ç‚¸å¼¹çˆ†ç‚¸äº†ï¼');
            }
        }
        
        // æ›´æ–°ç”Ÿå‘½æ˜¾ç¤º
        function updateLivesDisplay() {
            const lives = document.getElementById('lives-display').children;
            for (let i = 0; i < 3; i++) {
                if (i < gameState.lives) {
                    lives[i].classList.add('active');
                } else {
                    lives[i].classList.remove('active');
                }
            }
        }
        
        // æ£€æŸ¥èƒœåˆ©
        function checkWin() {
            if (gameState.modulesSolved >= gameState.totalModules) {
                gameOver(true, 'æ­å–œï¼ä½ æˆåŠŸæ‹†é™¤äº†ç‚¸å¼¹ï¼');
            }
        }
        
        // åˆ›å»ºç«ç„°ç²’å­
        function createFireParticle(x, y, intensity = 1) {
            const container = document.getElementById('fire-container');
            const colors = [
                'radial-gradient(circle, #ffffff 0%, #ffff00 30%, #ff6600 60%, transparent 100%)',
                'radial-gradient(circle, #ffff00 0%, #ff6600 40%, #ff0000 70%, transparent 100%)',
                'radial-gradient(circle, #ff6600 0%, #ff0000 50%, #990000 80%, transparent 100%)',
                'radial-gradient(circle, #ff0000 0%, #990000 50%, #330000 90%, transparent 100%)'
            ];
            
            const particleCount = 8 * intensity;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'fire-particle';
                
                const size = 20 + Math.random() * 60;
                const color = colors[Math.floor(Math.random() * colors.length)];
                const angle = Math.random() * Math.PI * 2;
                const distance = Math.random() * 300 * intensity;
                const tx = Math.cos(angle) * distance;
                const ty = Math.sin(angle) * distance - 200; // å‘ä¸Šé£˜
                
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                particle.style.background = color;
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                particle.style.setProperty('--tx', tx + 'px');
                particle.style.setProperty('--ty', ty + 'px');
                particle.style.animationDuration = (1.5 + Math.random() * 1.5) + 's';
                particle.style.boxShadow = `0 0 ${size/2}px rgba(255, 100, 0, 0.8)`;
                
                container.appendChild(particle);
                
                setTimeout(() => particle.remove(), 3000);
            }
        }
        
        // åˆ›å»ºå¤§çˆ†ç‚¸æ•ˆæœ
        function createMegaExplosion() {
            const centerX = window.innerWidth / 2;
            const centerY = window.innerHeight / 2;
            
            // å±å¹•éœ‡åŠ¨
            document.body.classList.add('screen-shake');
            setTimeout(() => document.body.classList.remove('screen-shake'), 500);
            
            // å†²å‡»æ³¢
            document.getElementById('shockwave').classList.add('active');
            setTimeout(() => document.getElementById('shockwave').classList.remove('active'), 2000);
            
            // å¤šè½®ç«ç„°çˆ†å‘
            for (let wave = 0; wave < 5; wave++) {
                setTimeout(() => {
                    createFireParticle(centerX, centerY, 2 + wave * 0.5);
                }, wave * 200);
            }
            
            // æŒç»­ç«èŠ±
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const angle = Math.random() * Math.PI * 2;
                    const distance = Math.random() * 200;
                    const x = centerX + Math.cos(angle) * distance;
                    const y = centerY + Math.sin(angle) * distance;
                    createSpark(x, y, 3);
                }, i * 80);
            }
            
            // çƒŸé›¾æ•ˆæœ
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    createSmoke(centerX + (Math.random() - 0.5) * 200, centerY + (Math.random() - 0.5) * 200);
                }, i * 150);
            }
        }
        
        // æ¸¸æˆç»“æŸ
        function gameOver(won, message) {
            cancelAnimationFrame(gameState.timerInterval);
            clearInterval(gameState.sparkInterval);
            
            const endIcon = document.getElementById('end-icon');
            const endTitle = document.getElementById('end-title');
            const endMessage = document.getElementById('end-message');
            
            if (won) {
                document.getElementById('game-screen').classList.add('hidden');
                document.getElementById('end-screen').classList.remove('hidden');
                
                endIcon.textContent = 'ğŸ‰';
                endTitle.innerHTML = '<span class="safe-text">ä»»åŠ¡å®Œæˆï¼</span>';
                endTitle.classList.add('heartbeat');
                addLog('ä»»åŠ¡å®Œæˆï¼ç‚¸å¼¹å·²å®‰å…¨æ‹†é™¤ï¼', 'success');
                playSound('success');
            } else {
                // å…ˆæ˜¾ç¤ºçˆ†ç‚¸æ•ˆæœ
                document.getElementById('explosion').classList.add('active');
                addLog('ä»»åŠ¡å¤±è´¥ï¼ç‚¸å¼¹çˆ†ç‚¸ï¼', 'danger');
                playSound('explosion');
                
                // åˆ›å»ºå¤§çˆ†ç‚¸
                createMegaExplosion();
                
                // å»¶è¿Ÿæ˜¾ç¤ºç»“æŸç•Œé¢
                setTimeout(() => {
                    document.getElementById('game-screen').classList.add('hidden');
                    document.getElementById('end-screen').classList.remove('hidden');
                    
                    endIcon.textContent = 'ğŸ’¥';
                    endTitle.innerHTML = '<span class="warning-text">ä»»åŠ¡å¤±è´¥ï¼</span>';
                }, 2500);
            }
            
            endMessage.textContent = message;
            
            // æ˜¾ç¤ºæœ€ç»ˆç»Ÿè®¡ - åŒ…å«æ¯«ç§’
            const hours = Math.floor(gameState.timeRemaining / 3600);
            const minutes = Math.floor((gameState.timeRemaining % 3600) / 60);
            const seconds = Math.floor(gameState.timeRemaining % 60);
            const milliseconds = Math.floor((gameState.timeRemaining % 1) * 1000);
            document.getElementById('final-time').textContent = 
                gameState.timeRemaining > 0 ? `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}.${String(milliseconds).padStart(3, '0')}` : '00:00:00.000';
            document.getElementById('final-modules').textContent = `${gameState.modulesSolved}/${gameState.totalModules}`;
            document.getElementById('final-lives').textContent = gameState.lives;
        }
        
        // æ·»åŠ æ—¥å¿—
        function addLog(message, type) {
            const log = document.getElementById('system-log');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            
            const time = new Date().toLocaleTimeString('zh-CN', { hour12: false });
            entry.textContent = `[${time}] ${message}`;
            
            if (type === 'success') {
                entry.classList.add('safe-text');
            } else if (type === 'danger') {
                entry.classList.add('warning-text');
            } else if (type === 'warning') {
                entry.classList.add('text-yellow-400');
            } else {
                entry.classList.add('text-gray-400');
            }
            
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }
        
        // åˆå§‹åŒ–é¢„è§ˆç‚¸å¼¹
        function initPreviewBomb() {
            const canvas = document.getElementById('preview-bomb');
            const ctx = canvas.getContext('2d');
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = 70;
            
            // ç‚¸å¼¹ä¸»ä½“
            const gradient = ctx.createRadialGradient(centerX - 15, centerY - 15, 0, centerX, centerY, radius);
            gradient.addColorStop(0, '#444');
            gradient.addColorStop(0.3, '#222');
            gradient.addColorStop(0.7, '#111');
            gradient.addColorStop(1, '#000');
            
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
            ctx.fillStyle = gradient;
            ctx.fill();
            
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 3;
            ctx.stroke();
            
            // å¼•ä¿¡
            ctx.strokeStyle = '#8B4513';
            ctx.lineWidth = 6;
            ctx.beginPath();
            ctx.moveTo(centerX, centerY - radius);
            ctx.quadraticCurveTo(centerX + 20, centerY - radius - 30, centerX + 40, centerY - radius - 20);
            ctx.stroke();
            
            // å€’è®¡æ—¶æ˜¾ç¤º
            ctx.fillStyle = '#000';
            ctx.fillRect(centerX - 40, centerY - 25, 80, 50);
            
            ctx.font = 'bold 24px "Share Tech Mono", monospace';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.shadowColor = '#ff0000';
            ctx.shadowBlur = 15;
            ctx.fillStyle = '#ff0000';
            ctx.fillText('18:00', centerX, centerY + 5);
        }
        
        // åˆå§‹åŒ–
        initBinaryBackground();
        initPreviewBomb();
    </script>
</body>
</html>
